<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exodia Multi-Sala</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .card-slot {
            @apply w-20 h-28 border-2 border-dashed border-gray-600 rounded-lg flex items-center justify-center text-[10px] text-center p-1 bg-gray-800 transition-all;
        }
        .card-active {
            @apply border-yellow-500 text-yellow-500 shadow-[0_0_10px_rgba(234,179,8,0.4)] bg-yellow-900/20;
        }
        .my-turn {
            @apply ring-4 ring-green-500 scale-105;
        }
    </style>
</head>
<body class="bg-slate-950 text-white min-h-screen flex items-center justify-center font-sans">

    <div id="lobby" class="bg-slate-900 p-8 rounded-2xl border border-slate-800 shadow-2xl w-full max-w-md">
        <h1 class="text-2xl font-black text-center mb-6 text-yellow-500 uppercase italic">Exodia Online</h1>
        <div class="space-y-4">
            <div>
                <label class="block text-xs uppercase text-slate-400 font-bold mb-1">C√≥digo da Sala</label>
                <input type="text" id="roomInput" placeholder="Ex: 123" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 focus:outline-none focus:border-yellow-500 transition-colors">
            </div>
            <button id="joinBtn" class="w-full bg-yellow-600 hover:bg-yellow-500 font-bold py-3 rounded-lg transition-all transform active:scale-95">
                ENTRAR NA PARTIDA
            </button>
        </div>
    </div>

    <div id="gameBoard" class="hidden w-full max-w-2xl px-4 flex flex-col items-center p-4">
        <div class="flex justify-between w-full mb-6 items-center">
            <div class="text-slate-400 text-sm font-bold">SALA: <span id="displayRoom" class="text-yellow-500 text-lg"></span></div>
            <div id="turnIndicator" class="px-4 py-1 rounded-full bg-slate-800 text-xs font-bold border border-slate-700 uppercase">Aguardando Jogadores...</div>
        </div>

        <div class="grid grid-cols-3 gap-3 mb-8">
            <div id="slot-braco-esq" class="card-slot">Bra√ßo Esq</div>
            <div id="slot-cabeca" class="card-slot border-red-900 bg-red-950/20 font-bold">CABE√áA</div>
            <div id="slot-braco-dir" class="card-slot">Bra√ßo Dir</div>
            <div id="slot-perna-esq" class="card-slot">Perna Esq</div>
            <div class="flex items-center justify-center font-black text-yellow-500 tracking-tighter italic">YOU</div>
            <div id="slot-perna-dir" class="card-slot">Perna Dir</div>
        </div>

        <div class="bg-slate-900 p-6 rounded-3xl border border-slate-800 flex flex-col items-center w-64 shadow-2xl">
            <div id="deckVisual" class="w-24 h-36 bg-gradient-to-br from-blue-700 to-blue-900 rounded-xl mb-4 border-2 border-blue-400 shadow-lg flex items-center justify-center">
                <span class="text-3xl opacity-50">üêâ</span>
            </div>
            <button id="drawBtn" disabled class="w-full py-3 rounded-xl font-black uppercase tracking-widest disabled:opacity-30 disabled:bg-slate-700 bg-yellow-600 hover:bg-yellow-500 shadow-lg transition-all">
                Puxar Carta
            </button>
            <p id="gameStatus" class="mt-4 text-[10px] text-slate-500 font-mono text-center h-4"></p>
        </div>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4">
        <div class="bg-slate-900 border-2 border-yellow-500 p-8 rounded-3xl text-center max-w-xs w-full shadow-[0_0_50px_rgba(234,179,8,0.3)]">
            <h2 id="modalMsg" class="text-3xl font-black text-yellow-500 mb-2 italic"></h2>
            <p id="modalSub" class="text-slate-400 text-sm mb-6"></p>
            <button onclick="location.reload()" class="w-full bg-white text-black font-bold py-3 rounded-xl">SAIR DA SALA</button>
        </div>
    </div>

    <script>
        let socket;
        let myPlayerNumber = null;
        let currentTurn = null;

        const lobby = document.getElementById('lobby');
        const gameBoard = document.getElementById('gameBoard');
        const drawBtn = document.getElementById('drawBtn');
        const turnIndicator = document.getElementById('turnIndicator');
        const statusText = document.getElementById('gameStatus');

        const slots = {
            "Bra√ßo Esquerdo": document.getElementById('slot-braco-esq'),
            "Bra√ßo Direito": document.getElementById('slot-braco-dir'),
            "Perna Esquerda": document.getElementById('slot-perna-esq'),
            "Perna Direito": document.getElementById('slot-perna-dir'),
            "CABE√áA DO EXODIA": document.getElementById('slot-cabeca')
        };

        document.getElementById('joinBtn').onclick = () => {
            const roomCode = document.getElementById('roomInput').value;
            if (!roomCode) return alert("Digite o n√∫mero da sala!");

            socket = new WebSocket('ws://localhost:8080');

            socket.onopen = () => {
                socket.send(JSON.stringify({ type: 'JOIN_ROOM', room: roomCode }));
                document.getElementById('displayRoom').innerText = roomCode;
                lobby.classList.add('hidden');
                gameBoard.classList.remove('hidden');
            };

            socket.onmessage = (event) => {
                const data = JSON.parse(event.data);

                if (data.type === 'INITIAL_HAND') {
                    myPlayerNumber = data.playerNumber;
                    data.cards.forEach(c => ativarCarta(c));
                }

                if (data.type === 'GAME_START' || data.type === 'NEXT_TURN') {
                    currentTurn = data.turno;
                    atualizarTurno();
                }

                if (data.type === 'DRAWN_CARD') {
                    statusText.innerText = `Puxou: ${data.card}`;
                }

                if (data.type === 'WINNER') {
                    ativarCarta("CABE√áA DO EXODIA");
                    showModal("VIT√ìRIA!", "O Exodia foi invocado por voc√™!");
                }

                if (data.type === 'GAME_OVER') {
                    showModal("DERROTA!", `Voc√™ foi obliterado!! ${data.winner} completou o Exodia.`);
                }

                if (data.type === 'ERROR') {
                    alert(data.msg);
                    location.reload();
                }
            };
        };

        drawBtn.onclick = () => {
            if (currentTurn === myPlayerNumber) {
                socket.send(JSON.stringify({ type: 'DRAW' }));
            }
        };

        function atualizarTurno() {
            if (currentTurn === myPlayerNumber) {
                turnIndicator.innerText = "SEU TURNO";
                turnIndicator.className = "px-4 py-1 rounded-full bg-green-600 text-white text-xs font-bold border border-green-400 uppercase animate-pulse";
                drawBtn.disabled = false;
                document.getElementById('deckVisual').classList.add('ring-4', 'ring-yellow-500');
            } else {
                turnIndicator.innerText = "TURNO DO OPONENTE";
                turnIndicator.className = "px-4 py-1 rounded-full bg-slate-800 text-slate-400 text-xs font-bold border border-slate-700 uppercase";
                drawBtn.disabled = true;
                document.getElementById('deckVisual').classList.remove('ring-4', 'ring-yellow-500');
            }
        }

        function ativarCarta(nome) {
            const slot = slots[nome];
            if (slot) slot.classList.add('card-active');
        }

        function showModal(title, sub) {
            document.getElementById('modalMsg').innerText = title;
            document.getElementById('modalSub').innerText = sub;
            document.getElementById('modal').classList.remove('hidden');
        }
    </script>
</body>
</html>